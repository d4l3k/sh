<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="game-board">
  <style>
    #damageBoard {
      display: flex;
      flex-wrap: wrap;
    }
    #damageBoard > div {
      border: 1px solid black;
      margin: 16px;
      padding: 5px;
      display: inline-block;
    }
    #player {
      color: red;
    }
    #areaBoard {
      display: flex;
      flex-wrap: wrap;
    }
    #areaBoard > div {
      border: 3px solid black;
      margin: 16px;
      padding: 5px;
      display: inline-block;
    }
  </style>

  <template>
    <div id="damageBoard">
      <template is="dom-repeat" items="[[health]]">
        <div>
          <h2>[[item.healthLevel]]</h2>
          <template is="dom-repeat" items="[[item.players]]">
            <span id="player">[[item.name]]</span>
          </template>
        </div>
      </template>
    </div>
    <div id="areaBoard">
      <template is="dom-repeat" items="[[area]]">
        <div>
          <h2>[[item.areaName]]</h2>
          <template is="dom-repeat" items="[[item.players]]">
            <span id="player">[[item.name]]</span>
          </template>
        </div>
      </template>
    </div>
	</template>

  <script>
    Polymer({
      is: 'game-board',

      properties: {
        state: {
          type: Object,
        },
      },

      observers: [
        'computeHealth(state.*)',
        'computeAreas(state.*)',
      ],

      computeAreas: function() {
        const areaNames = ["Hermit's Cabin", "Underworld Gate", "Church", "Cemetery", "Weird Woods", "Erstwhile Altar"];

        const areas = [];
        const areasMap = {};
        for (let name of areaNames) {
          const area = {
            areaName: name,
            players: []
          };
          areas.push(area);
          areasMap[name] = area;
        }

        for (let player of this.state.players){
            areasMap[player.area].players.push(player);
        }
        this.area = areas;
      },

      computeHealth: function() {
        const healths = [];

        for (let i=1; i<=14; i++) {
          healths.push({
            healthLevel: i,
            players: []
          });
        }

        for (let player of this.state.players) {
          healths[player.damage-1].players.push(player);
        }

        this.health = healths;
      }
    });
  </script>
</dom-module>
